<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Professional Coaches</title>
    <link rel="stylesheet" href="/css/components/navbar.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/pages/book-coach.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>

    <!-- Navbar Component -->
    <div id="navbar-container"></div>

    <div class="container">
        <div class="header">
            <h1>Book Professional Coaches</h1>
            <p>Train with certified coaches and take your skills to the next level</p>
        </div>

        <div class="search-section">
            <div class="search-filters">
                <div class="filter-group">
                    <label for="sport">Sport</label>
                    <select id="sport">
                        <option value="">All sports</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="location">Location</label>
                    <select id="location">
                        <option value="">All locations</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="price">Price Range</label>
                    <select id="price">
                        <option value="">Any price</option>
                        <option value="1000-2000">Rs.1000-Rs.2000</option>
                        <option value="2000-3000">Rs.2000-Rs.3000</option>
                        <option value="3000+">Rs.3000+</option>
                    </select>
                </div>
                <div class="filter-group">
                    <button class="search-btn" onclick="filterCoaches()">
                        üîç Search
                    </button>
                </div>
            </div>
        </div>

        <div class="results-header">
            <h2 id="results-count">Loading coaches...</h2>
        </div>

        <div id="coaches-grid" class="coaches-grid">
            <div class="loading">
                <div>Loading coaches...</div>
            </div>
        </div>
    </div>

    <script>
        // Configuration for API endpoints (replace with your actual backend URLs)
        const API_CONFIG = {
            baseUrl: '/api', // Replace with your backend URL
            endpoints: {
                coaches: '/coaches',
                sports: '/sports',
                locations: '/locations',
                bookings: '/bookings'
            }
        };

        // Global variables
        let allCoaches = [];
        let filteredCoaches = [];
        let isLoading = false;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function () {
            initializeApp();
        });

        async function initializeApp() {
            try {
                setLoading(true);

                // Load initial data
                await Promise.all([
                    loadCoaches(),
                    loadFilterOptions()
                ]);

                // Setup event listeners
                setupEventListeners();

                // Display initial results
                displayCoaches(allCoaches);

            } catch (error) {
                console.error('Failed to initialize app:', error);
                showError('Failed to load coaches. Please refresh the page.');
            } finally {
                setLoading(false);
            }
        }

        // Load coaches data (replace with API call)
        async function loadCoaches() {
            try {
                // For now, using static data. Replace this with actual API call:
                // const response = await fetch(`${API_CONFIG.baseUrl}${API_CONFIG.endpoints.coaches}`);
                // const coaches = await response.json();

                allCoaches = [
                    {
                        id: 1,
                        name: "R.T RATHNAYAKA",
                        sport: "Football",
                        location: "Colombo",
                        price: 1500,
                        rating: 4.9,
                        reviews: 156,
                        experience: 8,
                        image: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=200&h=200&fit=crop&crop=face",
                        description: "Former professional player with 8 years coaching experience. Specialized in youth development.He is famous for his smart game plans and winning many trophies.",
                        specializations: ["Youth Training", "Professional Coaching", "Tactical Analysis"],
                        certifications: ["FIFA B License", "Sports Science Diploma"],
                        isActive: true,
                        createdAt: "2024-01-15",
                        updatedAt: "2024-08-01"
                    },
                    {
                        id: 2,
                        name: "P.B JAYASUNDARA",
                        sport: "Cricket",
                        location: "Matara",
                        price: 2500,
                        rating: 4.8,
                        reviews: 203,
                        experience: 12,
                        image: "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=200&h=200&fit=crop&crop=face",
                        description: "Professional cricket coach with tournament experience. Focus on competitive players.He is known for being calm, honest, and good at training young players.",
                        specializations: ["Tournament Preparation", "Technique Development", "Mental Training"],
                        certifications: ["PTR Professional", "Sports Psychology"],
                        isActive: true,
                        createdAt: "2024-01-10",
                        updatedAt: "2024-07-28"
                    },
                    {
                        id: 3,
                        name: "CHANDANA WIMALARATHNA",
                        sport: "Badminton",
                        location: "Kandy",
                        price: 3500,
                        rating: 4.7,
                        reviews: 89,
                        experience: 6,
                        image: "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=200&h=200&fit=crop&crop=face",
                        description: "Former college player focused on fundamentals and skill development for all levels.He started the Gopichand Academy to train young players. He coached stars like PV Sindhu and Saina Nehwal, who won Olympic medals.",
                        specializations: ["Training Olympic-level players", "Defense Training", "Team Strategy"],
                        certifications: ["USA Coach Certification", "Badminton Fundamentals"],
                        isActive: true,
                        createdAt: "2024-02-01",
                        updatedAt: "2024-08-02"
                    },
                    {
                        id: 4,
                        name: "AMILA SURAWEERA",
                        sport: "Cricket",
                        location: "Galle",
                        price: 5000,
                        rating: 4.9,
                        reviews: 134,
                        experience: 10,
                        image: "https://images.unsplash.com/photo-1560250097-0b93528c311a?w=200&h=200&fit=crop&crop=face",
                        description: "Amila suraweera is the head coach of the Indian cricket team.",
                        specializations: ["Mental training", "Competitive Cricket"],
                        certifications: ["level 3 Cricket Coaching Certificate", "England and Wales Cricket Board (ECB) Level 3 Coaching Certificate"],
                        isActive: true,
                        createdAt: "2024-01-20",
                        updatedAt: "2024-07-30"
                    }
                ];

                // Filter only active coaches
                allCoaches = allCoaches.filter(coach => coach.isActive);

            } catch (error) {
                console.error('Error loading coaches:', error);
                throw error;
            }
        }

        // Load filter options dynamically
        async function loadFilterOptions() {
            try {
                // Extract unique sports and locations from coaches data
                // In production, you might want to fetch these from separate endpoints
                const sports = [...new Set(allCoaches.map(coach => coach.sport))].sort();
                const locations = [...new Set(allCoaches.map(coach => coach.location))].sort();

                // Populate sport filter
                const sportSelect = document.getElementById('sport');
                sports.forEach(sport => {
                    const option = document.createElement('option');
                    option.value = sport;
                    option.textContent = sport;
                    sportSelect.appendChild(option);
                });

                // Populate location filter
                const locationSelect = document.getElementById('location');
                locations.forEach(location => {
                    const option = document.createElement('option');
                    option.value = location;
                    option.textContent = location;
                    locationSelect.appendChild(option);
                });

            } catch (error) {
                console.error('Error loading filter options:', error);
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Filter change listeners
            document.querySelectorAll('select').forEach(select => {
                select.addEventListener('change', filterCoaches);
            });
        }

        // Display coaches in the grid
        function displayCoaches(coaches) {
            const grid = document.getElementById('coaches-grid');
            const resultsCount = document.getElementById('results-count');

            // Update results count
            resultsCount.textContent = `Available Coaches (${coaches.length})`;

            if (coaches.length === 0) {
                grid.innerHTML = `
                    <div class="no-results">
                        <div class="icon">üîç</div>
                        <h3>No coaches found</h3>
                        <p>Try adjusting your filters to see more results</p>
                    </div>
                `;
                return;
            }

            // Generate coach cards
            grid.innerHTML = coaches.map(coach => createCoachCard(coach)).join('');

            // Add event listeners to book buttons
            setupBookingListeners();
        }

        // Create HTML for a single coach card
        function createCoachCard(coach) {
            return `
                <div class="coach-card" data-coach-id="${coach.id}">
                    <div class="coach-header">
                        <img src="${coach.image}" alt="${coach.name}" class="coach-image" onerror="this.src='https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=200&h=200&fit=crop&crop=face'">
                        <div class="coach-info">
                            <h3>${coach.name}</h3>
                            <div class="coach-title">${coach.sport} Coach</div>
                            <div class="coach-meta">
                                <div class="rating">
                                    <span class="star">‚≠ê</span>
                                    <span>${coach.rating} (${coach.reviews})</span>
                                </div>
                                <span>${coach.experience} years exp</span>
                                <span class="location-badge">üìç${coach.location}</span>
                            </div>
                        </div>
                        <div class="price">Rs.${coach.price.toLocaleString()}<span style="font-size: 0.7rem; font-weight: 400;">/hour</span></div>
                    </div>
                    <div class="coach-description">
                        ${coach.description}
                    </div>
                    <div class="specializations">
                        <h4>Specializations:</h4>
                        <div class="tags">
                            ${coach.specializations.map(spec => `<span class="tag">${spec}</span>`).join('')}
                        </div>
                    </div>
                    <div class="certifications">
                        <h4>Certifications:</h4>
                        <div class="tags">
                            ${coach.certifications.map(cert => `<span class="cert-tag">${cert}</span>`).join('')}
                        </div>
                    </div>
                    <button class="book-btn" onclick="bookCoach(${coach.id})">üìû Book Coach</button>
                </div>
            `;
        }

        // Filter coaches based on selected criteria
        function filterCoaches() {
            const sportFilter = document.getElementById('sport').value;
            const locationFilter = document.getElementById('location').value;
            const priceFilter = document.getElementById('price').value;

            filteredCoaches = allCoaches.filter(coach => {
                // Sport filter
                if (sportFilter && coach.sport !== sportFilter) {
                    return false;
                }

                // Location filter
                if (locationFilter && coach.location !== locationFilter) {
                    return false;
                }

                // Price filter
                if (priceFilter) {
                    if (priceFilter === '1000-2000' && (coach.price < 1000 || coach.price > 2000)) {
                        return false;
                    }
                    if (priceFilter === '2000-3000' && (coach.price < 2000 || coach.price > 3000)) {
                        return false;
                    }
                    if (priceFilter === '3000+' && coach.price < 3000) {
                        return false;
                    }
                }

                return true;
            });

            displayCoaches(filteredCoaches);
        }

        // Setup booking button listeners
        function setupBookingListeners() {
            document.querySelectorAll('.book-btn').forEach(btn => {
                btn.addEventListener('click', function (e) {
                    e.preventDefault();
                    const coachId = parseInt(this.closest('.coach-card').dataset.coachId);
                    bookCoach(coachId);
                });
            });
        }

        // Book a coach (replace with actual booking logic)
        async function bookCoach(coachId) {
            try {
                const coach = allCoaches.find(c => c.id === coachId);
                if (!coach) {
                    throw new Error('Coach not found');
                }

                // Show loading state
                const button = document.querySelector(`[data-coach-id="${coachId}"] .book-btn`);
                const originalText = button.innerHTML;
                button.innerHTML = '‚è≥ Booking...';
                button.disabled = true;

                // Simulate API call (replace with actual booking API)
                // const response = await fetch(`${API_CONFIG.baseUrl}${API_CONFIG.endpoints.bookings}`, {
                //     method: 'POST',
                //     headers: {
                //         'Content-Type': 'application/json',
                //     },
                //     body: JSON.stringify({
                //         coachId: coachId,
                //         // Add other booking details
                //     })
                // });

                // Simulate delay
                await new Promise(resolve => setTimeout(resolve, 1000));

                // Reset button
                button.innerHTML = originalText;
                button.disabled = false;

                // Show success message (replace with proper booking flow)
                alert(`Booking request sent for ${coach.name}! You will be redirected to the booking form.`);

                // In production, redirect to booking form:
                // window.location.href = `/booking/${coachId}`;

            } catch (error) {
                console.error('Booking error:', error);
                alert('Failed to book coach. Please try again.');

                // Reset button state
                const button = document.querySelector(`[data-coach-id="${coachId}"] .book-btn`);
                button.innerHTML = 'üìû Book Coach';
                button.disabled = false;
            }
        }

        // Utility functions
        function setLoading(loading) {
            isLoading = loading;
            const grid = document.getElementById('coaches-grid');
            const resultsCount = document.getElementById('results-count');

            if (loading) {
                grid.innerHTML = '<div class="loading">Loading coaches...</div>';
                resultsCount.textContent = 'Loading coaches...';
            }
        }

        function showError(message) {
            const grid = document.getElementById('coaches-grid');
            grid.innerHTML = `
                <div class="no-results">
                    <div class="icon">‚ùå</div>
                    <h3>Error</h3>
                    <p>${message}</p>
                </div>
            `;
        }

        // API functions for future backend integration
        class CoachAPI {
            static async getCoaches(filters = {}) {
                const params = new URLSearchParams(filters);
                const response = await fetch(`${API_CONFIG.baseUrl}${API_CONFIG.endpoints.coaches}?${params}`);
                if (!response.ok) throw new Error('Failed to fetch coaches');
                return response.json();
            }

            static async getCoach(id) {
                const response = await fetch(`${API_CONFIG.baseUrl}${API_CONFIG.endpoints.coaches}/${id}`);
                if (!response.ok) throw new Error('Failed to fetch coach');
                return response.json();
            }

            static async bookCoach(coachId, bookingData) {
                const response = await fetch(`${API_CONFIG.baseUrl}${API_CONFIG.endpoints.bookings}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ coachId, ...bookingData })
                });
                if (!response.ok) throw new Error('Failed to book coach');
                return response.json();
            }

            static async getSports() {
                const response = await fetch(`${API_CONFIG.baseUrl}${API_CONFIG.endpoints.sports}`);
                if (!response.ok) throw new Error('Failed to fetch sports');
                return response.json();
            }

            static async getLocations() {
                const response = await fetch(`${API_CONFIG.baseUrl}${API_CONFIG.endpoints.locations}`);
                if (!response.ok) throw new Error('Failed to fetch locations');
                return response.json();
            }
        }

        // Refresh data function (can be called when needed)
        async function refreshCoaches() {
            try {
                setLoading(true);
                await loadCoaches();
                await loadFilterOptions();
                displayCoaches(allCoaches);
            } catch (error) {
                showError('Failed to refresh coaches data');
            } finally {
                setLoading(false);
            }
        }

        // Auto-refresh every 5 minutes (optional)
        // setInterval(refreshCoaches, 5 * 60 * 1000);
    </script>
    <script src="/js/components/navbar.js"></script>
    <script>
        // Load the shared navbar dynamically
        fetch('/pages/components/navbar.html')
            .then(res => res.text())
            .then(data => {
                document.getElementById('navbar-container').innerHTML = data;
                new Navbar(); // Initialize navbar behavior
            });

        // Global logout function
        function logout() {
            localStorage.removeItem('currentUser');
            window.location.href = '/';
        }
    </script>
</body>

</html>